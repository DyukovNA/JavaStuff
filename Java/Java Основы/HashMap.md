Что происходит при добавлении нового элемента?
![[Снимок экрана 2025-02-13 в 20.19.17.png]]

1. Создаётся таблица, в которой хранятся списки из элементов (Ключ, Значение )
2. loadFactor and threshold можно задать при создании мапы в конструкторе
3. Хешкод и индекс корзины равны 0. Все null попадают в корзину по индексу 0. Если null попадает повторно, то значение перезаписывается, несколько null быть не может![[Снимок экрана 2025-02-13 в 20.21.56.png]]
4. Иначе генерируется хеш на основе ключа key.hachCode(), по хешу определяется индекс корзины. Индекс = h & (length-1), где length - длина таблицы. По индексу кладётся в корзину
5. Если сгенерился повторяющийся индекс, то элемент попадает в ту же самую корзину, образуется коллизия. Проверяется существует ли ещё такой же хешкод
	1. Не существует - по принципу связанного списка в крайний элемент корзины записывается ссылка на этот элемент
	2. Существует - проверяются ключи
		1. Не совпадают - запись нового эл-а (п.1)
		2. Совпадают - замена значения на новое
6. С Java 8 - Если размер корзины превышает 15 элементов - корзина с linkedlist заменяется на binarytree

Immutable объекты (например строки) - лучшие ключи т.к. их содержание не изменяется и хеш является константой, он уже рассчитан